<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use App\Models\User;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules\Password; // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø–∞—Ä–æ–ª—è

class AuthController extends Controller
{
    // –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    public function showRegisterForm()
    {
        // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–æ–≤
        // if (!Auth::check() || !Auth::user()->is_super_admin) {
        //     abort(403);
        // }

        return view('admin.auth.register');
    }

    public function register(Request $request)
    {
        $request->validate([
            'name' => 'required|string|max:255',
            'email' => 'required|email|unique:users',
            'password' => [
                'required',
                'confirmed',
                Password::min(8) // –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é
                ->letters()
                    ->mixedCase()
                    ->numbers()
                    ->symbols()
            ],
        ]);

        User::create([
            'name' => $request->name,
            'email' => $request->email,
            'password' => Hash::make($request->password),
            'is_admin' => true,
        ]);

        return redirect()->route('admin.login')->with('success', '–ê–∫–∫–∞—É–Ω—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
    }

    // –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
    public function showLoginForm()
    {
        // –ï—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –∞–¥–º–∏–Ω - —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ –∞–¥–º–∏–Ω–∫—É
        if (Auth::check() && Auth::user()->is_admin) {
            return redirect()->route('admin.dashboard');
        }

        return view('admin.auth.login');
    }

    public function login(Request $request)
    {
        $credentials = $request->validate([
            'email' => 'required|email',
            'password' => 'required',
        ]);

        // –ü–æ–ø—ã—Ç–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π is_admin
        if (Auth::attempt($credentials)) {
            if (Auth::user()->is_admin) {
                $request->session()->regenerate();
                return redirect()->intended(route('admin.dashboard'));
            } else {
                Auth::logout(); // –í—ã—Ö–æ–¥ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω
                return back()->withErrors([
                    'email' => '–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º',
                ]);
            }
        }

        return back()->withErrors([
            'email' => '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ',
        ])->onlyInput('email');
    }

    // –í—ã—Ö–æ–¥
    public function logout(Request $request)
    {
        Auth::logout();
        $request->session()->invalidate();
        $request->session()->regenerateToken();
        return redirect()->route('admin.login');
    }
}
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage; // !!! –î–û–ë–ê–í–õ–ï–ù–û –î–õ–Ø –†–ê–ë–û–¢–´ –° –§–ê–ô–õ–ê–ú–ò !!!

class CategoryController extends Controller
{
    // List all categories
    public function index()
    {
        $categories = Category::all();
        return view('admin.categories.index', compact('categories'));
    }

    // Show form to create a new category
    public function create()
    {
        return view('admin.categories.create');
    }

    // Store a new category
    public function store(Request $request)
    {
        $request->validate([
            'name' => 'required|string|max:255|unique:categories', // –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
            'image_path' => 'nullable|image|mimes:jpeg,png,jpg,gif|max:2048'
        ]);

        $data = $request->only(['name', 'description']);

        if ($request->hasFile('image_path')) {
            $path = $request->file('image_path')->store('images/categories', 'public');
            $data['image_path'] = $path;
        }

        Category::create($data);

        return redirect()->route('admin.categories.index')
            ->with('success', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
    }

    // Show form to edit an existing category
    public function edit(Category $category) // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Route-Model Binding
    {
        return view('admin.categories.edit', compact('category'));
    }

    // Update an existing category
    public function update(Request $request, Category $category) // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Route-Model Binding
    {
        $request->validate([
            'name' => 'required|string|max:255|unique:categories,name,' . $category->id, // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
            'image_path' => 'nullable|image|mimes:jpeg,png,jpg,gif|max:2048'
        ]);

        $data = $request->only(['name', 'description']);

        if ($request->hasFile('image_path')) {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if ($category->image_path) {
                Storage::disk('public')->delete($category->image_path);
            }

            $path = $request->file('image_path')->store('images/categories', 'public');
            $data['image_path'] = $path;
        }

        $category->update($data);

        return redirect()->route('admin.categories.index')
            ->with('success', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
    }

    // Delete a category
    public function destroy(Category $category)
    {
        if ($category->products()->count() > 0) {
            return redirect()->route('admin.categories.index')
                ->with('error', '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —É –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã.');
        }

        // –£–¥–∞–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        if ($category->image_path) {
            Storage::disk('public')->delete($category->image_path);
        }

        $category->delete();

        return redirect()->route('admin.categories.index')
            ->with('success', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
    }


    public function show(Category $category)
    {
        $products = $category->products;

        return view('admin.categories.show', compact('category', 'products'));
    }
}
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Tool;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage;

class ProductController extends Controller
{
    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ (—Å –ø–æ–∏—Å–∫–æ–º).
     */
    public function index(Request $request)
    {
        $products = Product::latest()
            ->search($request->input('search')) // <-- 1. –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—à scope
            ->paginate(12)
            ->withQueryString(); // <-- 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

        return view('admin.products.index', compact('products'));
    }

    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.
     */
    public function create()
    {
        $categories = Category::all();
        return view('admin.products.create', compact('categories'));
    }

    /**
     * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
     */
    public function store(Request $request)
    {
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∞—Ä–º—è–Ω—Å–∫–∏–º —è–∑—ã–∫–æ–º
        $request->validate([
            'name.hy' => 'required|string|max:255',
            'name.ru' => 'nullable|string|max:255',
            'name.en' => 'nullable|string|max:255',
            'description.hy' => 'nullable|string',
            'description.ru' => 'nullable|string',
            'description.en' => 'nullable|string',
            'category_id' => 'required|exists:categories,id',
            'price' => 'nullable|numeric',
            'lift_capacity' => 'nullable|string|max:100',
            'engine_hp' => 'nullable|string|max:50',
            'image_path' => 'nullable|image|mimes:jpeg,png,jpg,gif|max:2048',
        ]);

        $data = $request->except('image_path');

        if ($request->hasFile('image_path')) {
            $path = $request-php>file('image_path')->store('images/products', 'public');
            $data['image_path'] = $path;
        }

        Product::create($data);

        return redirect()->route('admin.products.index')
            ->with('success', __('messages.product_added_successfully'));
    }

    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.
     */
    public function edit(Product $product)
    {
        $categories = Category::all();
        $tools = Tool::all(); // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        $productToolIds = $product->tools()->pluck('id')->toArray();
        return view('admin.products.edit', compact('product', 'categories','tools', 'productToolIds'));
    }

    /**
     * –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ.
     */
    public function update(Request $request, Product $product)
    {
        $request->validate([
            'name.hy' => 'required|string|max:255',
            'name.ru' => 'nullable|string|max:255',
            'name.en' => 'nullable|string|max:255',
            'description.hy' => 'nullable|string',
            'description.ru' => 'nullable|string',
            'description.en' => 'nullable|string',
            'category_id' => 'required|exists:categories,id',
            'price' => 'nullable|numeric',
            'lift_capacity' => 'nullable|string|max:100',
            'engine_hp' => 'nullable|string|max:50',
            'image_path' => 'nullable|image|mimes:jpeg,png,jpg,gif|max:2048',
        ]);

        $data = $request->except('image_path');

        if ($request->hasFile('image_path')) {
            if ($product->image_path) {
                Storage::disk('public')->delete($product->image_path);
            }
            $path = $request->file('image_path')->store('images/products', 'public');
            $data['image_path'] = $path;
        }

        $product->update($data);

        if ($request->has('tools')) {
            $product->tools()->sync($request->input('tools'));
        } else {
            $product->tools()->sync([]); // –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω, –æ—Ç–≤—è–∑—ã–≤–∞–µ–º –≤—Å–µ
        }

        return redirect()->route('admin.products.index')
            ->with('success', __('messages.product_updated_successfully'));
    }

    /**
     * –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
     */
    public function destroy(Product $product)
    {
        if ($product->image_path) {
            Storage::disk('public')->delete($product->image_path);
        }

        $product->delete();

        return redirect()->route('admin.products.index')
            ->with('success', __('messages.product_deleted_successfully'));
    }
}
<?php

namespace App\Http\Controllers\Admin; // <-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω–æ Admin

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Tool;
use Illuminate\Http\Request;
use Illuminate\Pagination\LengthAwarePaginator;
use Illuminate\Support\Collection;

class SearchController extends Controller // <-- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ç–µ–ø–µ—Ä—å –≤ –ø–∞–ø–∫–µ Admin
{
    /**
     * –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–±—â–∏–π –ø–æ–∏—Å–∫ –ø–æ –ü—Ä–æ–¥—É–∫—Ç–∞–º –∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º.
     */
    public function index(Request $request)
    {
        $searchTerm = $request->input('query');
        $perPage = 12; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        $currentPage = LengthAwarePaginator::resolveCurrentPage();

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
        if (empty($searchTerm)) {
            // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –ø–∞–≥–∏–Ω–∞—Ç–æ—Ä
            $emptyResults = new LengthAwarePaginator(
                [], 0, $perPage, $currentPage
            );
            return view('admin.search.index', ['results' => $emptyResults, 'searchTerm' => $searchTerm]);
        }

        // 2. –ü–æ–∏—Å–∫ –≤ –ü—Ä–æ–¥—É–∫—Ç–∞—Ö
        // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ scopeSearch –≤ –º–æ–¥–µ–ª–∏ Product
        $products = Product::latest()
            ->search($searchTerm)
            ->get()
            ->map(function ($item) {
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                $item->type = 'product';
                $item->link = route('admin.products.edit', $item);
                $item->display_name = $item->getTranslation('name', 'hy');
                return $item;
            });

        // 3. –ü–æ–∏—Å–∫ –≤ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö
        // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ scopeSearch –≤ –º–æ–¥–µ–ª–∏ Tool
        $tools = Tool::latest()
            ->search($searchTerm)
            ->get()
            ->map(function ($item) {
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                $item->type = 'tool';
                $item->link = route('admin.tools.edit', $item);
                $item->display_name = $item->getTranslation('name', 'hy');
                return $item;
            });

        // 4. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        $allResults = $products->merge($tools)
            ->sortByDesc('created_at');

        // 5. –†—É—á–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        // –ë–µ—Ä–µ–º —Å—Ä–µ–∑ (slice) –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        $currentItems = $allResults->slice(($currentPage * $perPage) - $perPage, $perPage)->all();

        // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–∞–≥–∏–Ω–∞—Ç–æ—Ä–∞
        $results = new LengthAwarePaginator(
            $currentItems,
            $allResults->count(), // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            $perPage,
            $currentPage,
            ['path' => $request->url(), 'query' => $request->query()] // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
        );

        return view('admin.search.index', compact('results', 'searchTerm'));
    }
}
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use App\Models\Product;
use App\Models\Tool;
use Illuminate\Http\Request;

class ToolController extends Controller
{
    public function index()
    {
        $categories = Category::all();
        return view('admin.tools.index', compact('categories'));
    }

    public function show(Category $category)
    {
        $tools = $category->tools()->latest()->paginate(15);
        return view('admin.tools.list', compact('category', 'tools'));
    }

    public function create(Category $category)
    {
        $products = Product::all();
        return view('admin.tools.create', compact('category', 'products'));
    }

    public function store(Request $request)
    {
        // –ò–ó–ú–ï–ù–ï–ù–û –ó–î–ï–°–¨
        $request->validate([
            'category_id' => 'required|exists:categories,id',
            'product_id' => 'nullable|exists:products,id',
            'name' => 'required|string|max:255',
            'description' => 'nullable|string',
            'price' => 'nullable|numeric|min:0',
            'sku' => 'nullable|string|max:100|unique:tools,sku',
            'image' => 'nullable|image|mimes:jpeg,png,jpg,gif,webp|max:2048',
        ]);

        $data = $request->except('image'); // –ò–ó–ú–ï–ù–ï–ù–û

        if ($request->hasFile('image')) { // –ò–ó–ú–ï–ù–ï–ù–û
            $path = $request->file('image')->store('images/tools', 'public'); // –ò–ó–ú–ï–ù–ï–ù–û
            $data['image'] = $path; // –ò–ó–ú–ï–ù–ï–ù–û
        }

        Tool::create($data);

        return redirect()->route('admin.tools.show', $request->category_id)
            ->with('success', '’ç’°÷Ä÷Ñ’°’æ’∏÷Ä’∏÷Ç’¥’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’°’æ’•’¨’°÷Å’æ’•’¨ ’ß÷â');
    }
    public function destroy(Tool $tool)
    {
        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –∫—É–¥–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è
        $categoryId = $tool->category_id;

        // –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        $tool->delete();

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        return redirect()->route('admin.tools.show', $categoryId)
            ->with('success', '’ç’°÷Ä÷Ñ’°’æ’∏÷Ä’∏÷Ç’¥’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’ª’∂’ª’æ’•’¨ ’ß÷â'); // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.
    }
    public function edit(Tool $tool)
    {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –∏–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        $categories = \App\Models\Category::all();

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–µ—Ä–µ–¥–∞–≤–∞—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        return view('admin.tools.edit', compact('tool', 'categories'));
    }
    public function update(Request $request, Tool $tool)
    {
        // TODO: –î–æ–±–∞–≤—å—Ç–µ –∑–¥–µ—Å—å –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏!

        $data = $request->except(['_token', '_method']); // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω—ã

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è
        if ($request->hasFile('image')) {
            // ... (–í–∞—à–∞ –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
        }

        $tool->update($data);

        return redirect()->route('admin.tools.show', $tool->category_id)
            ->with('success', '‘≥’∏÷Ä’Æ’´÷Ñ’® ’∞’°’ª’∏’≤’∏÷Ç’©’µ’°’¥’¢ ’©’°÷Ä’¥’°÷Å’æ’•’¨ ’ß÷â');
    }
}
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Spatie\Translatable\HasTranslations;


class Category extends Model
{
    use HasFactory, HasTranslations;

    public $translatable = ['name', 'description'];
    protected $fillable = ['name', 'description', 'image_path'];

    public function products()
    {
        return $this->hasMany(Product::class);
    }

    /**
     * –î–û–ë–ê–í–¨–¢–ï –≠–¢–û–¢ –ú–ï–¢–û–î
     * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
     */
    public function tools()
    {
        return $this->hasMany(Tool::class);
    }
}
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Spatie\Translatable\HasTranslations;
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª–∞—Å—Å—ã –ø–∞–∫–µ—Ç–∞
use Spatie\Sluggable\HasSlug;
use Spatie\Sluggable\SlugOptions;

class Product extends Model
{
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ç—Ä–µ–π—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∏ –¥–ª—è slug
    use HasFactory, HasTranslations, HasSlug;

    public $translatable = ['name', 'description'];

    // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—è (slug, status –∏ —Ç.–¥.) –∑–¥–µ—Å—å –µ—Å—Ç—å
    protected $fillable = [
        'name', 'slug', 'description', 'category_id', 'price',
        'status', 'meta_title', 'meta_description',
        'lift_capacity', 'engine_hp', 'image_path',
    ];

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –æ–ø—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ slug.
     */
    public function getSlugOptions() : SlugOptions
    {
        return SlugOptions::create()
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º slug –∏–∑ –∞—Ä–º—è–Ω—Å–∫–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
            ->generateSlugsFrom('name.hy')
            ->saveSlugsTo('slug');
    }

    /**
     * –°–≤—è–∑—å —Å –º–æ–¥–µ–ª—å—é Category.
     */
    public function category()
    {
        return $this->belongsTo(Category::class);
    }

    /**
     * Scope –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö.
     */
    public function scopeSearch($query, $term)
    {
        if (!empty($term)) {
            $query->where(function ($q) use ($term) {

                // –í–ê–ñ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª–µ 'name' —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º JSON
                $q->whereRaw('JSON_VALID(name)')
                    ->where(function ($q2) use ($term) {
                        // –ò—â–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ –ø–æ–ª—é 'name' –≤–æ –≤—Å–µ—Ö –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è—Ö (hy, ru, en)
                        $q2->whereRaw("JSON_EXTRACT(name, '$.hy') LIKE ?", ["%{$term}%"])
                            ->orWhereRaw("JSON_EXTRACT(name, '$.ru') LIKE ?", ["%{$term}%"])
                            ->orWhereRaw("JSON_EXTRACT(name, '$.en') LIKE ?", ["%{$term}%"]);
                    });

                // –ï—Å–ª–∏ 'description' —Ç–æ–∂–µ JSON –∏ –≤—ã –ø–æ –Ω–µ–º—É –∏—â–µ—Ç–µ, –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É JSON_VALID(description)
                // –ï—Å–ª–∏ 'description' –Ω–µ JSON –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–π—Ç–µ.
            });
        }

        return $query;
    }
    public function tools()
    {
        return $this->belongsToMany(Tool::class);
    }
}
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Spatie\Translatable\HasTranslations; // <-- –î–û–ë–ê–í–ò–¢–¨ –≠–¢–û–¢ USE

class Tool extends Model
{
    use HasFactory, HasTranslations; // <-- –î–û–ë–ê–í–ò–¢–¨ –≠–¢–û–¢ –¢–†–ï–ô–¢

    // üõë –≠–¢–û–¢ –ú–ê–°–°–ò–í –ì–û–í–û–†–ò–¢ LARAVEL/SPATIE, –ß–¢–û –ù–£–ñ–ù–û –•–†–ê–ù–ò–¢–¨ –í JSON
    public $translatable = ['name', 'description'];

    /**
     * The attributes that are mass assignable.
     *
     * @var array
     */
    protected $fillable = ['category_id', 'name', 'sku', 'description','image'];

    // ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –≤–∫–ª—é—á–∞—è scopeSearch, –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏)
    public function scopeSearch($query, $term)
    {
        // ... (–í–∞—à –∫–æ–¥ scopeSearch —Å JSON_VALID())
    }
    // ...
}
<?php

namespace App\Models;

use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable;

    /**
     * The attributes that are mass assignable.
     *
     * @var array<int, string>
     */
    protected $fillable = [
        'name',
        'email',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var array<int, string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * The attributes that should be cast.
     *
     * @var array<string, string>
     */
    protected $casts = [
        'email_verified_at' => 'datetime',
    ];
}
<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\ProductController;
use App\Http\Controllers\Admin\CategoryController as AdminCategory;
use App\Http\Controllers\Admin\ProductController as AdminProduct;
use App\Http\Controllers\Admin\ToolController as AdminTool;
use App\Http\Controllers\Admin\AuthController;
use App\Http\Controllers\Admin\SearchController; // <-- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –µ—Å—Ç—å!

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
*/

// –ú–∞—Ä—à—Ä—É—Ç –¥–ª—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
Route::get('language/{locale}', function ($locale) {
    if (in_array($locale, ['en', 'ru', 'hy'])) {
        session()->put('locale', $locale);
    }
    return redirect()->back();
})->name('language.switch');


// –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
Route::get('/', function () {
    return view('welcome');
});


Route::get('/catalog', [ProductController::class, 'index'])->name('products.index');

Route::prefix('admin')->name('admin.')->group(function() {

    // –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –≥–æ—Å—Ç–µ–π
    Route::get('register', [AuthController::class, 'showRegisterForm'])->name('register');
    Route::post('register', [AuthController::class, 'register']);
    Route::get('login', [AuthController::class, 'showLoginForm'])->name('login');
    Route::post('login', [AuthController::class, 'login']);


    // –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    Route::middleware(['auth'])->group(function () {

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        Route::post('logout', [AuthController::class, 'logout'])->name('logout');

        // –ì–ª–∞–≤–Ω—ã–π URL –∞–¥–º–∏–Ω–∫–∏ -> –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –¥–∞—à–±–æ—Ä–¥
        Route::get('/', function () {
            return redirect()->route('admin.dashboard');
        });

        // Dashboard
        Route::get('dashboard', function () {
            return view('admin.dashboard');
        })->name('dashboard');

        // –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        Route::resource('categories', AdminCategory::class);

        // –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        Route::resource('products', AdminProduct::class);

        // ================================================================
        // –ú–ê–†–®–†–£–¢ –û–ë–©–ï–ì–û –ü–û–ò–°–ö–ê (–ù–û–í–ê–Ø –°–¢–†–û–ö–ê)
        // ================================================================
        Route::get('/search', [SearchController::class, 'index'])->name('search.index');

        // ================================================================
        // –ü–†–ê–í–ò–õ–¨–ù–´–ï –ú–ê–†–®–†–£–¢–´ –î–õ–Ø –ò–ù–°–¢–†–£–ú–ï–ù–¢–û–í
        // ================================================================
        // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        Route::get('tools', [AdminTool::class, 'index'])->name('tools.index');
        // –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        Route::get('tools/{category}', [AdminTool::class, 'show'])->name('tools.show');
        // –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ñ–æ—Ä–º–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        Route::get('tools/{category}/create', [AdminTool::class, 'create'])->name('tools.create');
        // –ú–∞—Ä—à—Ä—É—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        Route::post('tools', [AdminTool::class, 'store'])->name('tools.store');

        // –í–æ—Ç —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã —É–∫–∞–∑–∞–ª–∏, —è –æ—Å—Ç–∞–≤–∏–ª –µ–µ
        Route::delete('tools/{tool}', [AdminTool::class, 'destroy'])->name('tools.destroy');
        // -------------------------------------------

        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        Route::get('tools/{tool}/edit', [AdminTool::class, 'edit'])->name('tools.edit');
        Route::put('tools/{tool}', [AdminTool::class, 'update'])->name('tools.update');


    });
});





























